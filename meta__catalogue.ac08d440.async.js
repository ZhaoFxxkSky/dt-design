"use strict";(self.webpackChunkdt_design=self.webpackChunkdt_design||[]).push([[7624],{75190:function(a,n,e){e.r(n),e.d(n,{demos:function(){return d}});var t=e(75271),d={"catalogue-demo-basic":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,36489))})),asset:{type:"BLOCK",id:"catalogue-demo-basic",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(96477).Z},react:{type:"NPM",value:"18.3.1"},"dt-design":{type:"NPM",value:"1.0.0"}},entry:"index.tsx",title:"\u5E26\u6709 Title \u7EAF\u5C55\u793A\u7684\u76EE\u5F55\u6811"},context:void 0,renderOpts:void 0},"catalogue-demo-simple":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,51117))})),asset:{type:"BLOCK",id:"catalogue-demo-simple",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(78914).Z},react:{type:"NPM",value:"18.3.1"},"dt-design":{type:"NPM",value:"1.0.0"}},entry:"index.tsx",title:"\u65E0 Title \u7EAF\u5C55\u793A\u64CD\u4F5C\u9879\u7684\u76EE\u5F55\u6811"},context:void 0,renderOpts:void 0},"catalogue-demo-operator":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,39075))})),asset:{type:"BLOCK",id:"catalogue-demo-operator",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(89607).Z},react:{type:"NPM",value:"18.3.1"},"@dtinsight/react-icons":{type:"NPM",value:"1.5.0"},antd:{type:"NPM",value:"4.22.5"},"dt-design":{type:"NPM",value:"1.0.0"},"lodash-es":{type:"NPM",value:"4.17.21"},shortid:{type:"NPM",value:"2.2.17"},"../utils.tsx":{type:"FILE",value:e(3146).Z}},entry:"index.tsx",title:"\u53EF\u64CD\u4F5C\u7684\u76EE\u5F55\u6811"},context:void 0,renderOpts:void 0},"catalogue-demo-drag":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,33166))})),asset:{type:"BLOCK",id:"catalogue-demo-drag",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(96665).Z},react:{type:"NPM",value:"18.3.1"},"@dtinsight/react-icons":{type:"NPM",value:"1.5.0"},antd:{type:"NPM",value:"4.22.5"},"dt-design":{type:"NPM",value:"1.0.0"},"lodash-es":{type:"NPM",value:"4.17.21"},shortid:{type:"NPM",value:"2.2.17"},"../utils.tsx":{type:"FILE",value:e(3146).Z}},entry:"index.tsx",title:"\u53EF\u62D6\u62FD\u7684\u76EE\u5F55\u6811"},context:void 0,renderOpts:void 0},"catalogue-demo-config":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,31202))})),asset:{type:"BLOCK",id:"catalogue-demo-config",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(86712).Z},react:{type:"NPM",value:"18.3.1"},"@dtinsight/react-icons":{type:"NPM",value:"1.5.0"},antd:{type:"NPM",value:"4.22.5"},"dt-design":{type:"NPM",value:"1.0.0"},"lodash-es":{type:"NPM",value:"4.17.21"},shortid:{type:"NPM",value:"2.2.17"},"../utils.tsx":{type:"FILE",value:e(3146).Z}},entry:"index.tsx",title:"\u914D\u7F6E\u64CD\u4F5C\u9879\u7684\u76EE\u5F55\u6811"},context:void 0,renderOpts:void 0},"catalogue-demo-tabs":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,59801))})),asset:{type:"BLOCK",id:"catalogue-demo-tabs",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(91552).Z},react:{type:"NPM",value:"18.3.1"},"dt-design":{type:"NPM",value:"1.0.0"}},entry:"index.tsx",title:"\u914D\u7F6E\u64CD\u4F5C\u9879\u7684\u76EE\u5F55\u6811"},context:void 0,renderOpts:void 0},"catalogue-demo-async":{component:t.memo(t.lazy(function(){return Promise.all([e.e(7350),e.e(327),e.e(1270),e.e(3370),e.e(1204),e.e(8704),e.e(1273),e.e(7127),e.e(3350),e.e(478),e.e(168),e.e(4470),e.e(2878),e.e(8327),e.e(2179),e.e(1939),e.e(5053),e.e(1911),e.e(1952),e.e(4920),e.e(7670)]).then(e.bind(e,25095))})),asset:{type:"BLOCK",id:"catalogue-demo-async",refAtomIds:["catalogue"],dependencies:{"index.tsx":{type:"FILE",value:e(17565).Z},react:{type:"NPM",value:"18.3.1"},"dt-design":{type:"NPM",value:"1.0.0"}},entry:"index.tsx",title:"\u5F02\u6B65\u52A0\u8F7D\u6570\u636E"},context:void 0,renderOpts:void 0}}},81396:function(a,n,e){e.r(n),e.d(n,{texts:function(){return t}});const t=[{value:"\u7528\u4E8E\u5C55\u793A\u76EE\u5F55\u6811",paraId:0,tocIndex:0},{value:"\u9002\u5408\u4F7F\u7528\u5728\u9700\u8981\u5C55\u793A\u76EE\u5F55\u6811\u7684\u5730\u65B9",paraId:1,tocIndex:1},{value:"\u53C2\u6570",paraId:2,tocIndex:11},{value:"\u8BF4\u660E",paraId:2,tocIndex:11},{value:"\u7C7B\u578B",paraId:2,tocIndex:11},{value:"\u9ED8\u8BA4\u503C",paraId:2,tocIndex:11},{value:"loading",paraId:2,tocIndex:11},{value:"\u76EE\u5F55\u6811\u662F\u5426\u52A0\u8F7D\u4E2D",paraId:2,tocIndex:11},{value:"boolean",paraId:2,tocIndex:11},{value:"false",paraId:2,tocIndex:11},{value:"overlay",paraId:2,tocIndex:11},{value:"\u76EE\u5F55\u6811\u7684\u64CD\u4F5C\u914D\u7F6E",paraId:2,tocIndex:11},{value:"(item: ITreeNode) => DropdownProps['overlay']",paraId:2,tocIndex:11},{value:"-",paraId:2,tocIndex:11},{value:"treeData",paraId:2,tocIndex:11},{value:"\u76EE\u5F55\u6811\u662F\u5426\u52A0\u8F7D\u4E2D",paraId:2,tocIndex:11},{value:"ITreeNode[]",paraId:2,tocIndex:11},{value:"[]",paraId:2,tocIndex:11},{value:"showSearch",paraId:2,tocIndex:11},{value:"\u662F\u5426\u5C55\u793A\u641C\u7D22\u6846",paraId:2,tocIndex:11},{value:"boolean",paraId:2,tocIndex:11},{value:"false",paraId:2,tocIndex:11},{value:"edit",paraId:2,tocIndex:11},{value:"\u76EE\u5F55\u662F\u5426\u53EF\u4EE5\u64CD\u4F5C",paraId:2,tocIndex:11},{value:"boolean",paraId:2,tocIndex:11},{value:"true",paraId:2,tocIndex:11},{value:"placeholder",paraId:2,tocIndex:11},{value:"\u641C\u7D22\u6846\u7684\u9ED8\u8BA4\u5C55\u793A\u5185\u5BB9",paraId:2,tocIndex:11},{value:"string",paraId:2,tocIndex:11},{value:"\u641C\u7D22\u76EE\u5F55\u540D\u79F0",paraId:2,tocIndex:11},{value:"onSearch",paraId:2,tocIndex:11},{value:"\u70B9\u51FB\u641C\u7D22\u56FE\u6807\u3001\u6E05\u9664\u56FE\u6807\u65F6\u7684\u56DE\u8C03",paraId:2,tocIndex:11},{value:"(value: string) => void",paraId:2,tocIndex:11},{value:"-",paraId:2,tocIndex:11},{value:"onSave",paraId:2,tocIndex:11},{value:"\u65B0\u589E/\u7F16\u8F91\u65F6\u7684\u56DE\u8C03",paraId:2,tocIndex:11},{value:"(data: ITreeNode, value: string) => Promise<string | void>",paraId:2,tocIndex:11},{value:"-",paraId:2,tocIndex:11},{value:"onChange",paraId:2,tocIndex:11},{value:"\u89E6\u53D1\u65B0\u589E/\u7F16\u8F91\u7684\u56DE\u8C03",paraId:2,tocIndex:11},{value:"(node?: ITreeNode, inputMode?: InputMode) => void",paraId:2,tocIndex:11},{value:"-",paraId:2,tocIndex:11},{value:"\u5176\u4F59\u53C2\u6570\u7EE7\u627F antd4.x \u7684 ",paraId:3},{value:"Omit<TreeProps, 'showLine' | 'switcherIcon' | 'showIcon' | 'treeData'>",paraId:3},{value:`
\u7EE7\u627F dt-design \u7684 `,paraId:3},{value:"Pick<IBlockHeaderProps, 'tooltip' | 'addonAfter' | 'addonBefore' | 'title'>",paraId:3},{value:"TreeProps",paraId:3},{value:"\uFF0C",paraId:3},{value:"IBlockHeaderProps",paraId:3},{value:"\u53C2\u6570",paraId:4,tocIndex:12},{value:"\u8BF4\u660E",paraId:4,tocIndex:12},{value:"\u7C7B\u578B",paraId:4,tocIndex:12},{value:"\u9ED8\u8BA4\u503C",paraId:4,tocIndex:12},{value:"inputMode",paraId:4,tocIndex:12},{value:"\u8282\u70B9\u8F93\u5165\u6846\u7C7B\u578B",paraId:4,tocIndex:12},{value:"add | edit | append",paraId:4,tocIndex:12},{value:"-",paraId:4,tocIndex:12},{value:"editable",paraId:4,tocIndex:12},{value:"\u662F\u5426\u53EF\u7F16\u8F91",paraId:4,tocIndex:12},{value:"boolean",paraId:4,tocIndex:12},{value:"true",paraId:4,tocIndex:12},{value:"deletable",paraId:4,tocIndex:12},{value:"\u662F\u5426\u53EF\u5220\u9664",paraId:4,tocIndex:12},{value:"boolean",paraId:4,tocIndex:12},{value:"true",paraId:4,tocIndex:12},{value:"addable",paraId:4,tocIndex:12},{value:"\u662F\u5426\u53EF\u589E\u52A0",paraId:4,tocIndex:12},{value:"boolean",paraId:4,tocIndex:12},{value:"true",paraId:4,tocIndex:12},{value:"children",paraId:4,tocIndex:12},{value:"\u5B50\u8282\u70B9",paraId:4,tocIndex:12},{value:"ITreeNode[]",paraId:4,tocIndex:12},{value:"-",paraId:4,tocIndex:12}]},17565:function(a,n){n.Z=`import React, { useEffect } from 'react';
import { Catalogue } from 'dt-design';
import { useTreeData } from 'dt-design/catalogue/useTreeData';
import { insertChildIntoNode } from 'dt-design/catalogue/utils';

interface DataNode {
    title: string;
    key: string;
    isLeaf?: boolean;
    children?: DataNode[];
}

const initTreeData: DataNode[] = [
    { title: 'Expand to load', key: '0' },
    { title: 'Expand to load', key: '1' },
    { title: 'Tree Node', key: '2', isLeaf: true },
];

const App: React.FC = () => {
    const treeData = useTreeData();

    useEffect(() => {
        treeData.onChange(initTreeData);
    }, []);

    const onLoadData = ({ key, children }: any) =>
        new Promise<void>((resolve) => {
            if (children) {
                resolve();
                return;
            }
            setTimeout(() => {
                const newData = insertChildIntoNode(treeData.data, key, [
                    { title: 'Child Node', key: \`\${key}-0\` },
                    { title: 'Child Node', key: \`\${key}-1\` },
                ]);
                treeData.onChange(newData);
                resolve();
            }, 1000);
        });

    return <Catalogue loadData={onLoadData} treeData={treeData.data} />;
};

export default App;
`},96477:function(a,n){n.Z=`import React, { useEffect } from 'react';
import { Catalogue } from 'dt-design';
import { useTreeData } from 'dt-design/catalogue/useTreeData';

const DEFAULT_DATA = [
    {
        title: '0-0',
        key: '0-0',
        children: [
            {
                title: '\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957FTitle',
                key: '0-0-0',
                children: [
                    { title: '0-0-0-0', key: '0-0-0-0' },
                    { title: '0-0-0-1', key: '0-0-0-1' },
                    { title: '0-0-0-2', key: '0-0-0-2' },
                ],
            },
            {
                title: '0-0-1',
                key: '0-0-1',
                children: [
                    { title: '0-0-1-0', key: '0-0-1-0' },
                    { title: '0-0-1-1', key: '0-0-1-1' },
                    { title: '0-0-1-2', key: '0-0-1-2' },
                ],
            },
            {
                title: '0-0-2',
                key: '0-0-2',
            },
        ],
    },
    {
        title: '0-1',
        key: '0-1',
        children: [
            { title: '0-1-0-0', key: '0-1-0-0' },
            { title: '0-1-0-1', key: '0-1-0-1' },
            { title: '0-1-0-2', key: '0-1-0-2' },
        ],
    },
    {
        title: '0-2',
        key: '0-2',
    },
];

export default () => {
    const treeData = useTreeData();

    useEffect(() => {
        treeData.onChange(DEFAULT_DATA);
    }, []);

    return (
        <div style={{ height: 300, width: 320 }}>
            <Catalogue
                tooltip="\u563F\u563F\uFF0C\u8FD9\u662Ftooltip"
                title="\u6807\u7B7E\u76EE\u5F55"
                showSearch
                treeData={treeData.data}
                edit={false}
                expandedKeys={treeData.expandedKeys}
                onExpand={treeData.onExpand}
            />
        </div>
    );
};
`},86712:function(a,n){n.Z=`import React, { useEffect } from 'react';
import { DeleteOutlined, EditOutlined, PlusSquareOutlined } from '@dtinsight/react-icons';
import { Menu } from 'antd';
import { Catalogue } from 'dt-design';
import { CatalogueProps } from 'dt-design/catalogue/components/catalogue';
import { ITreeNode, useTreeData } from 'dt-design/catalogue/useTreeData';
import { cloneDeep } from 'lodash-es';
import shortid from 'shortid';

import {
    appendNodeByKey,
    findNodeByKey,
    findParentNodeByKey,
    removeEditNode,
    removeNodeByKey,
    updateTreeNodeEdit,
} from '../utils';

const DEFAULT_DATA: ITreeNode<IData>[] = [
    {
        title: '\u4E0D\u53EF\u7F16\u8F91\u7684\u8282\u70B9',
        editable: false,
        key: '0-0',
        children: [
            {
                title: '\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957FTitle',
                key: '0-0-0',
                children: [
                    {
                        title: '0-0-0-0',
                        key: '0-0-0-0',
                    },
                    { title: '0-0-0-1', key: '0-0-0-1' },
                    { title: '0-0-0-2', key: '0-0-0-2' },
                ],
            },
            {
                title: '0-0-1',
                key: '0-0-1',
                children: [
                    { title: '0-0-1-0', key: '0-0-1-0' },
                    { title: '0-0-1-1', key: '0-0-1-1' },
                    { title: '0-0-1-2', key: '0-0-1-2' },
                ],
            },
            {
                title: '0-0-2',
                key: '0-0-2',
            },
        ],
    },
    {
        title: '\u4E0D\u53EF\u65B0\u589E\u7684\u8282\u70B9',
        addable: false,
        key: '0-1',
        children: [
            { title: '0-1-0-0', key: '0-1-0-0' },
            { title: '0-1-0-1', key: '0-1-0-1' },
            { title: '0-1-0-2', key: '0-1-0-2' },
        ],
    },
    {
        title: '\u4E0D\u53EF\u5220\u9664\u8282\u70B9',
        key: '0-2',
        deletable: false,
    },
];

interface IData {
    edit?: boolean;
    addable?: boolean;
    deletable?: boolean;
    editable?: boolean;
}

export default () => {
    const treeData = useTreeData<IData>();

    const handleEdit = (key: ITreeNode<IData>['key']) => {
        const data = updateTreeNodeEdit<IData>(treeData.data, key);
        treeData.onChange(data);
    };

    const handleAdd = (key: ITreeNode<IData>['key']) => {
        const newExpandedKeys = treeData.expandedKeys ? [...treeData.expandedKeys] : [];
        const data = appendNodeByKey<IData>(treeData.data, key);
        if (!newExpandedKeys?.includes(key)) {
            newExpandedKeys.push(key);
        }
        treeData.onExpand(newExpandedKeys);
        treeData.onChange(data);
    };

    const handleSave = async (data: ITreeNode, value: string) => {
        const newData = cloneDeep(treeData.data);
        if (!data.key) {
            newData.push({
                title: value,
                key: shortid(),
            });
            newData.shift();
            treeData.onChange(newData);
            return;
        }
        if ((data.key as string).startsWith('new')) {
            let node = findParentNodeByKey(newData, data.key);
            if (!node) return;
            if (node.children) {
                const newChildren = node.children
                    .filter((item) => !item.edit)
                    .concat({ title: value, key: shortid() });
                node.children = newChildren;
            } else {
                node = {
                    ...node,
                    children: [
                        {
                            title: value,
                            key: shortid(),
                        },
                    ],
                };
            }
            treeData.onChange(newData);
            return;
        }
        const node = findNodeByKey(newData, data.key);
        if (node) {
            node.title = value;
            node.edit = false;
        }
        treeData.onChange(newData);
    };

    const handleCancelSave = () => {
        const newData = removeEditNode(treeData.data);
        treeData.onChange(newData);
    };

    const handleDelete = (data: ITreeNode) => {
        let newData = cloneDeep(treeData.data);
        newData = removeNodeByKey(newData, data.key);
        treeData.onChange(newData);
    };

    const handleDrop: CatalogueProps['onDrop'] = (info) => {
        const dropKey = info.node.key;
        const dragKey = info.dragNode.key;
        const dropPos = info.node.pos.split('-');
        const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]); // the drop position relative to the drop node, inside 0, top -1, bottom 1

        const loop = (
            data: ITreeNode[],
            key: React.Key,
            callback: (node: ITreeNode, i: number, data: ITreeNode[]) => void
        ) => {
            for (let i = 0; i < data.length; i++) {
                if (data[i].key === key) {
                    return callback(data[i], i, data);
                }
                if (data[i].children) {
                    loop(data[i].children!, key, callback);
                }
            }
        };
        const data = [...treeData.data];

        // Find dragObject
        let dragObj: ITreeNode;
        loop(data, dragKey, (item, index, arr) => {
            arr.splice(index, 1);
            dragObj = item;
        });
        if (!info.dropToGap) {
            // Drop on the content
            loop(data, dropKey, (item) => {
                item.children = item.children || [];
                // where to insert. New item was inserted to the start of the array in this example, but can be anywhere
                item.children.unshift(dragObj);
            });
        } else {
            let ar: ITreeNode[] = [];
            let i: number;
            loop(data, dropKey, (_item, index, arr) => {
                ar = arr;
                i = index;
            });
            if (dropPosition === -1) {
                // Drop on the top of the drop node
                ar.splice(i!, 0, dragObj!);
            } else {
                // Drop on the bottom of the drop node
                ar.splice(i! + 1, 0, dragObj!);
            }
        }
        treeData.onChange(data);
    };

    useEffect(() => {
        treeData.onChange(DEFAULT_DATA);
    }, []);

    return (
        <div style={{ height: 300, width: 320 }}>
            <Catalogue
                tooltip="\u563F\u563F\uFF0C\u8FD9\u662Ftooltip"
                addonAfter={
                    <PlusSquareOutlined
                        style={{ cursor: 'pointer' }}
                        onClick={() =>
                            treeData.onChange([
                                ...treeData.data,
                                { edit: true, title: '', key: '' },
                            ])
                        }
                    />
                }
                title="\u6807\u7B7E\u76EE\u5F55"
                showSearch
                draggable
                overlay={(item) => {
                    const { addable = true, editable = true, deletable = true } = item;
                    return (
                        <Menu
                            onClick={({ domEvent }) => {
                                domEvent.stopPropagation();
                            }}
                        >
                            <Menu.Item
                                key="add"
                                disabled={!addable}
                                onClick={() => addable && handleAdd(item.key)}
                            >
                                <PlusSquareOutlined />
                                <span>\u65B0\u5EFA\u76EE\u5F55</span>
                            </Menu.Item>
                            <Menu.Item
                                key="edit"
                                className="title__menu--item"
                                disabled={!editable}
                                onClick={() => editable && handleEdit(item.key)}
                            >
                                <EditOutlined />
                                <span>\u7F16\u8F91</span>
                            </Menu.Item>
                            <Menu.Item
                                key="delete"
                                className="title__menu--item"
                                disabled={!deletable}
                                onClick={() => deletable && handleDelete(item)}
                            >
                                <DeleteOutlined />
                                <span>\u5220\u9664</span>
                            </Menu.Item>
                        </Menu>
                    );
                }}
                treeData={treeData.data}
                expandedKeys={treeData.expandedKeys}
                onExpand={treeData.onExpand}
                onDragEnter={({ expandedKeys }) => treeData.onExpand(expandedKeys)}
                onSave={handleSave}
                onCancelSave={handleCancelSave}
                onDrop={handleDrop}
            />
        </div>
    );
};
`},96665:function(a,n){n.Z=`import React, { useEffect } from 'react';
import { DeleteOutlined, EditOutlined, PlusSquareOutlined } from '@dtinsight/react-icons';
import { Menu } from 'antd';
import { Catalogue } from 'dt-design';
import { CatalogueProps } from 'dt-design/catalogue/components/catalogue';
import { ITreeNode, useTreeData } from 'dt-design/catalogue/useTreeData';
import { cloneDeep } from 'lodash-es';
import shortid from 'shortid';

import {
    appendNodeByKey,
    findNodeByKey,
    findParentNodeByKey,
    removeEditNode,
    removeNodeByKey,
    updateTreeNodeEdit,
} from '../utils';

interface IData {
    edit?: boolean;
    addable?: boolean;
    deletable?: boolean;
    editable?: boolean;
}

const DEFAULT_DATA = [
    {
        title: '0-0',
        key: '0-0',
        children: [
            {
                title: '0-0-0',
                key: '0-0-0',
                children: [
                    { title: '0-0-0-0', key: '0-0-0-0' },
                    { title: '0-0-0-1', key: '0-0-0-1' },
                    { title: '0-0-0-2', key: '0-0-0-2' },
                ],
            },
            {
                title: '0-0-1',
                key: '0-0-1',
                children: [
                    { title: '0-0-1-0', key: '0-0-1-0' },
                    { title: '0-0-1-1', key: '0-0-1-1' },
                    { title: '0-0-1-2', key: '0-0-1-2' },
                ],
            },
            {
                title: '0-0-2',
                key: '0-0-2',
            },
        ],
    },
    {
        title: '0-1',
        key: '0-1',
        children: [
            { title: '0-1-0-0', key: '0-1-0-0' },
            { title: '0-1-0-1', key: '0-1-0-1' },
            { title: '0-1-0-2', key: '0-1-0-2' },
        ],
    },
    {
        title: '0-2',
        key: '0-2',
    },
];

export default () => {
    const treeData = useTreeData<IData>();

    const handleEdit = (key: ITreeNode<IData>['key']) => {
        const data = updateTreeNodeEdit<IData>(treeData.data, key);
        treeData.onChange(data);
    };

    const handleAdd = (key: ITreeNode<IData>['key']) => {
        const newExpandedKeys = treeData.expandedKeys ? [...treeData.expandedKeys] : [];
        const data = appendNodeByKey<IData>(treeData.data, key);
        if (!newExpandedKeys?.includes(key)) {
            newExpandedKeys.push(key);
        }
        treeData.onExpand(newExpandedKeys);
        treeData.onChange(data);
    };

    const handleSave = async (data: ITreeNode, value: string) => {
        const newData = cloneDeep(treeData.data);
        if (!data.key) {
            newData.push({
                title: value,
                key: shortid(),
            });
            newData.shift();
            treeData.onChange(newData);
            return;
        }
        if ((data.key as string).startsWith('new')) {
            let node = findParentNodeByKey(newData, data.key);
            if (!node) return;
            if (node.children) {
                const newChildren = node.children
                    .filter((item) => !item.edit)
                    .concat({ title: value, key: shortid() });
                node.children = newChildren;
            } else {
                node = {
                    ...node,
                    children: [
                        {
                            title: value,
                            key: shortid(),
                        },
                    ],
                };
            }
            treeData.onChange(newData);
            return;
        }
        const node = findNodeByKey(newData, data.key);
        if (node) {
            node.title = value;
            node.edit = false;
        }
        treeData.onChange(newData);
    };

    const handleCancelSave = () => {
        const newData = removeEditNode(treeData.data);
        treeData.onChange(newData);
    };

    const handleDelete = (data: ITreeNode) => {
        let newData = cloneDeep(treeData.data);
        newData = removeNodeByKey(newData, data.key);
        treeData.onChange(newData);
    };

    const handleDrop: CatalogueProps['onDrop'] = (info) => {
        const dropKey = info.node.key;
        const dragKey = info.dragNode.key;
        const dropPos = info.node.pos.split('-');
        const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]); // the drop position relative to the drop node, inside 0, top -1, bottom 1

        const loop = (
            data: ITreeNode[],
            key: React.Key,
            callback: (node: ITreeNode, i: number, data: ITreeNode[]) => void
        ) => {
            for (let i = 0; i < data.length; i++) {
                if (data[i].key === key) {
                    return callback(data[i], i, data);
                }
                if (data[i].children) {
                    loop(data[i].children!, key, callback);
                }
            }
        };
        const data = [...treeData.data];

        // Find dragObject
        let dragObj: ITreeNode;
        loop(data, dragKey, (item, index, arr) => {
            arr.splice(index, 1);
            dragObj = item;
        });
        if (!info.dropToGap) {
            // Drop on the content
            loop(data, dropKey, (item) => {
                item.children = item.children || [];
                // where to insert. New item was inserted to the start of the array in this example, but can be anywhere
                item.children.unshift(dragObj);
            });
        } else {
            let ar: ITreeNode[] = [];
            let i: number;
            loop(data, dropKey, (_item, index, arr) => {
                ar = arr;
                i = index;
            });
            if (dropPosition === -1) {
                // Drop on the top of the drop node
                ar.splice(i!, 0, dragObj!);
            } else {
                // Drop on the bottom of the drop node
                ar.splice(i! + 1, 0, dragObj!);
            }
        }
        treeData.onChange(data);
    };

    useEffect(() => {
        treeData.onChange(DEFAULT_DATA);
    }, []);

    return (
        <div style={{ height: 300, width: 320 }}>
            <Catalogue
                tooltip="\u563F\u563F\uFF0C\u8FD9\u662Ftooltip"
                addonAfter={
                    <PlusSquareOutlined
                        style={{ cursor: 'pointer' }}
                        onClick={() =>
                            treeData.onChange([
                                ...treeData.data,
                                { edit: true, title: '', key: '' },
                            ])
                        }
                    />
                }
                title="\u6807\u7B7E\u76EE\u5F55"
                showSearch
                draggable
                overlay={(item) => {
                    const { addable = true, editable = true, deletable = true } = item;
                    return (
                        <Menu
                            onClick={({ domEvent }) => {
                                domEvent.stopPropagation();
                            }}
                        >
                            <Menu.Item
                                key="add"
                                disabled={!addable}
                                onClick={() => addable && handleAdd(item.key)}
                            >
                                <PlusSquareOutlined />
                                <span>\u65B0\u5EFA\u76EE\u5F55</span>
                            </Menu.Item>
                            <Menu.Item
                                key="edit"
                                className="title__menu--item"
                                disabled={!editable}
                                onClick={() => editable && handleEdit(item.key)}
                            >
                                <EditOutlined />
                                <span>\u7F16\u8F91</span>
                            </Menu.Item>
                            <Menu.Item
                                key="delete"
                                className="title__menu--item"
                                disabled={!deletable}
                                onClick={() => deletable && handleDelete(item)}
                            >
                                <DeleteOutlined />
                                <span>\u5220\u9664</span>
                            </Menu.Item>
                        </Menu>
                    );
                }}
                treeData={treeData.data}
                expandedKeys={treeData.expandedKeys}
                onExpand={treeData.onExpand}
                onDragEnter={({ expandedKeys }) => treeData.onExpand(expandedKeys)}
                onSave={handleSave}
                onCancelSave={handleCancelSave}
                onDrop={handleDrop}
            />
        </div>
    );
};
`},89607:function(a,n){n.Z=`import React, { useEffect } from 'react';
import { DeleteOutlined, EditOutlined, PlusSquareOutlined } from '@dtinsight/react-icons';
import { Menu } from 'antd';
import { Catalogue } from 'dt-design';
import { ITreeNode, useTreeData } from 'dt-design/catalogue/useTreeData';
import { cloneDeep } from 'lodash-es';
import shortid from 'shortid';

import {
    appendNodeByKey,
    findNodeByKey,
    findParentNodeByKey,
    removeEditNode,
    removeNodeByKey,
    updateTreeNodeEdit,
} from '../utils';

const DEFAULT_DATA = [
    {
        title: '0-0',
        key: '0-0',
        addable: true,
        deletable: true,
        editable: true,
        children: [
            {
                title: '0-0-0',
                key: '0-0-0',
                addable: true,
                deletable: true,
                editable: true,
                children: [
                    {
                        title: '0-0-0-0',
                        key: '0-0-0-0',
                        addable: true,
                        deletable: true,
                        editable: true,
                    },
                    {
                        title: '0-0-0-1',
                        key: '0-0-0-1',
                        addable: true,
                        deletable: true,
                        editable: true,
                    },
                    {
                        title: '0-0-0-2',
                        key: '0-0-0-2',
                        addable: true,
                        deletable: true,
                        editable: true,
                    },
                ],
            },
            {
                title: '0-0-1',
                key: '0-0-1',
                children: [
                    {
                        title: '0-0-1-0',
                        key: '0-0-1-0',
                        addable: true,
                        deletable: true,
                        editable: true,
                    },
                    {
                        title: '0-0-1-1',
                        key: '0-0-1-1',
                        addable: true,
                        deletable: true,
                        editable: true,
                    },
                    {
                        title: '0-0-1-2',
                        key: '0-0-1-2',
                        addable: true,
                        deletable: true,
                        editable: true,
                    },
                ],
                addable: true,
                deletable: true,
                editable: true,
            },
            {
                title: '0-0-2',
                key: '0-0-2',
                addable: true,
                deletable: true,
                editable: true,
            },
        ],
    },
    {
        title: '0-1',
        key: '0-1',
        addable: true,
        deletable: true,
        editable: true,
        children: [
            { title: '0-1-0-0', key: '0-1-0-0', addable: true, deletable: true, editable: true },
            { title: '0-1-0-1', key: '0-1-0-1', addable: true, deletable: true, editable: true },
            { title: '0-1-0-2', key: '0-1-0-2', addable: true, deletable: true, editable: true },
        ],
    },
    {
        title: '0-2',
        key: '0-2',
        addable: true,
        deletable: true,
        editable: true,
    },
];

interface IData {
    edit?: boolean;
    addable?: boolean;
    deletable?: boolean;
    editable?: boolean;
}

export default () => {
    const treeData = useTreeData<IData>();

    const handleEdit = (key: ITreeNode<IData>['key']) => {
        const data = updateTreeNodeEdit<IData>(treeData.data, key);
        treeData.onChange(data);
    };

    const handleAdd = (key: ITreeNode<IData>['key']) => {
        const newExpandedKeys = treeData.expandedKeys ? [...treeData.expandedKeys] : [];
        const data = appendNodeByKey<IData>(treeData.data, key);
        if (!newExpandedKeys?.includes(key)) {
            newExpandedKeys.push(key);
        }
        treeData.onExpand(newExpandedKeys);
        treeData.onChange(data);
    };

    const handleSave = async (data: ITreeNode, value: string) => {
        const newData = cloneDeep(treeData.data);
        if (!data.key) {
            newData.push({
                title: value,
                key: shortid(),
            });
            newData.shift();
            treeData.onChange(newData);
            return;
        }
        if ((data.key as string).startsWith('new')) {
            let node = findParentNodeByKey(newData, data.key);
            if (!node) return;
            if (node.children) {
                const newChildren = node.children
                    .filter((item) => !item.edit)
                    .concat({ title: value, key: shortid() });
                node.children = newChildren;
            } else {
                node = {
                    ...node,
                    children: [
                        {
                            title: value,
                            key: shortid(),
                        },
                    ],
                };
            }
            treeData.onChange(newData);
            return;
        }
        const node = findNodeByKey(newData, data.key);
        if (node) {
            node.title = value;
            node.edit = false;
        }
        treeData.onChange(newData);
    };

    const handleCancelSave = () => {
        const newData = removeEditNode(treeData.data);
        treeData.onChange(newData);
    };

    const handleDelete = (data: ITreeNode) => {
        let newData = cloneDeep(treeData.data);
        newData = removeNodeByKey(newData, data.key);
        treeData.onChange(newData);
    };

    useEffect(() => {
        treeData.onChange(DEFAULT_DATA);
    }, []);

    return (
        <div style={{ height: 300, width: 320 }}>
            <Catalogue<IData, any>
                tooltip="\u563F\u563F\uFF0C\u8FD9\u662Ftooltip"
                addonAfter={
                    <PlusSquareOutlined
                        style={{ cursor: 'pointer' }}
                        onClick={() =>
                            treeData.onChange([
                                ...treeData.data,
                                { edit: true, title: '', key: '' },
                            ])
                        }
                    />
                }
                title="\u6807\u7B7E\u76EE\u5F55"
                overlay={(item) => {
                    const { addable = true, editable = true, deletable = true } = item;
                    return (
                        <Menu
                            onClick={({ domEvent }) => {
                                domEvent.stopPropagation();
                            }}
                        >
                            <Menu.Item
                                key="add"
                                disabled={!addable}
                                onClick={() => addable && handleAdd(item.key)}
                            >
                                <PlusSquareOutlined />
                                <span>\u65B0\u5EFA\u76EE\u5F55</span>
                            </Menu.Item>
                            <Menu.Item
                                key="edit"
                                className="title__menu--item"
                                disabled={!editable}
                                onClick={() => editable && handleEdit(item.key)}
                            >
                                <EditOutlined />
                                <span>\u7F16\u8F91</span>
                            </Menu.Item>
                            <Menu.Item
                                key="delete"
                                className="title__menu--item"
                                disabled={!deletable}
                                onClick={() => deletable && handleDelete(item)}
                            >
                                <DeleteOutlined />
                                <span>\u5220\u9664</span>
                            </Menu.Item>
                        </Menu>
                    );
                }}
                showSearch
                treeData={treeData.data}
                expandedKeys={treeData.expandedKeys}
                onExpand={treeData.onExpand}
                onSave={handleSave}
                onCancelSave={handleCancelSave}
            />
        </div>
    );
};
`},78914:function(a,n){n.Z=`import React, { useEffect } from 'react';
import { Catalogue } from 'dt-design';
import { useTreeData } from 'dt-design/catalogue/useTreeData';

const DEFAULT_DATA = [
    {
        title: '0-0',
        key: '0-0',
        children: [
            {
                title: '\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957FTitle',
                key: '0-0-0',
                children: [
                    { title: '0-0-0-0', key: '0-0-0-0' },
                    { title: '0-0-0-1', key: '0-0-0-1' },
                    { title: '0-0-0-2', key: '0-0-0-2' },
                ],
            },
            {
                title: '0-0-1',
                key: '0-0-1',
                children: [
                    { title: '0-0-1-0', key: '0-0-1-0' },
                    { title: '0-0-1-1', key: '0-0-1-1' },
                    { title: '0-0-1-2', key: '0-0-1-2' },
                ],
            },
            {
                title: '0-0-2',
                key: '0-0-2',
            },
        ],
    },
    {
        title: '0-1',
        key: '0-1',
        children: [
            { title: '0-1-0-0', key: '0-1-0-0' },
            { title: '0-1-0-1', key: '0-1-0-1' },
            { title: '0-1-0-2', key: '0-1-0-2' },
        ],
    },
    {
        title: '0-2',
        key: '0-2',
    },
];

export default () => {
    const treeData = useTreeData();

    useEffect(() => {
        treeData.onChange(DEFAULT_DATA);
    }, []);

    return (
        <div style={{ height: 300, width: 320 }}>
            <Catalogue.Tree treeData={treeData.data} />
        </div>
    );
};
`},91552:function(a,n){n.Z=`import React, { useEffect, useState } from 'react';
import { Catalogue } from 'dt-design';
import { useTreeData } from 'dt-design/catalogue/useTreeData';

enum TreeType {
    Api = 'api',
    Index = 'index',
}

const DEFAULT_DATA = (key: TreeType) => [
    {
        title: \`0-0-\${key}\`,
        key: '0-0',
        children: [
            {
                title: '\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957F\u957FTitle',
                key: '0-0-0',
                children: [
                    { title: '0-0-0-0', key: '0-0-0-0' },
                    { title: '0-0-0-1', key: '0-0-0-1' },
                    { title: '0-0-0-2', key: '0-0-0-2' },
                ],
            },
            {
                title: '0-0-1',
                key: '0-0-1',
                children: [
                    { title: '0-0-1-0', key: '0-0-1-0' },
                    { title: '0-0-1-1', key: '0-0-1-1' },
                    { title: '0-0-1-2', key: '0-0-1-2' },
                ],
            },
            {
                title: '0-0-2',
                key: '0-0-2',
            },
        ],
    },
    {
        title: \`0-1-\${key}\`,
        key: '0-1',
        children: [
            { title: '0-1-0-0', key: '0-1-0-0' },
            { title: '0-1-0-1', key: '0-1-0-1' },
            { title: '0-1-0-2', key: '0-1-0-2' },
        ],
    },
    {
        title: \`0-2-\${key}\`,
        key: '0-2',
    },
];

export default () => {
    const treeData = useTreeData();
    const [activeKey, setActiveKey] = useState(TreeType.Index);

    useEffect(() => {
        treeData.onChange(DEFAULT_DATA(activeKey));
    }, [activeKey]);

    return (
        <div style={{ height: 300, width: 320 }}>
            <Catalogue
                tooltip="\u563F\u563F\uFF0C\u8FD9\u662Ftooltip"
                title="\u6807\u7B7E\u76EE\u5F55"
                showSearch
                treeData={treeData.data}
                edit={false}
                activeTabKey={activeKey}
                tabList={
                    [
                        { key: TreeType.Api, title: 'API' },
                        { key: TreeType.Index, title: '\u6307\u6807' },
                    ] as const
                }
                onTabChange={(key) => setActiveKey(key)}
                expandedKeys={treeData.expandedKeys}
                onExpand={treeData.onExpand}
            />
        </div>
    );
};
`},3146:function(a,n){n.Z=`import React from 'react';
import { FolderFilled, FolderOpenedFilled } from '@dtinsight/react-icons';

import { CatalogueProps } from './components/catalogue';
import { ITreeNode } from './useTreeData';

export const getIcon: ITreeNode['icon'] = ({ selected, expanded }) => {
    const styles: React.CSSProperties = {
        fontSize: 16,
        color: '#1D78FF',
    };

    if (expanded || selected) return <FolderOpenedFilled style={styles} />;
    return <FolderFilled style={styles} />;
};

/**
 * @description \u8F6E\u8BE2 Tree \u6570\u636E\uFF0C\u8D4B\u503C\u641C\u7D22\u6807\u8BC6\u548CleafIcon
 */
export const loopTree = <T extends Record<string, any>>(
    data: CatalogueProps<T>['treeData']
): CatalogueProps<T>['treeData'] => {
    return data?.map((item) => {
        if (item.children) {
            return {
                icon: getIcon,
                ...item,
                children: loopTree(item.children),
            };
        }
        return {
            icon: getIcon,
            ...item,
            children: undefined,
        };
    });
};

/**
 * \u67E5\u627E key \u5BF9\u5E94\u7684\u8282\u70B9
 * @param data \u904D\u5386\u7684\u6570\u7EC4
 * @param key \u5F53\u524D key \u503C
 * @returns \u627E\u5230\u7684\u5BF9\u5E94\u8282\u70B9
 */
export const findNodeByKey = <U,>(
    data: ITreeNode<U>[],
    key: ITreeNode<U>['key']
): ITreeNode<U> | null => {
    for (const node of data) {
        if (node.key === key) {
            return node;
        }
        if (node.children) {
            const result = findNodeByKey(node.children, key);
            if (result) return result;
        }
    }
    return null;
};

/**
 * \u66F4\u65B0 key \u5BF9\u5E94\u8282\u70B9\u4E3A\u7F16\u8F91\u72B6\u6001
 * @param data \u904D\u5386\u7684\u6570\u7EC4
 * @param key \u5F53\u524D key \u503C
 * @returns \u66F4\u65B0\u4E4B\u540E data
 */
export const updateTreeNodeEdit = <U,>(
    data: ITreeNode<U>[],
    key: ITreeNode<U>['key']
): ITreeNode<U>[] => {
    return data.map((node) => {
        if (node.key === key) {
            return { ...node, edit: true };
        }
        if (node.children) {
            return { ...node, children: updateTreeNodeEdit(node.children, key) };
        }
        return node;
    });
};

/**
 * \u67E5\u627E key \u5BF9\u5E94\u7684\u7236\u7EA7\u8282\u70B9
 * @param data \u904D\u5386\u7684\u6570\u7EC4
 * @param key \u5F53\u524D key \u503C
 * @returns \u5F53\u524D\u627E\u5230\u7236\u7EA7\u8282\u70B9
 */
export const findParentNodeByKey = <U extends { edit?: boolean }>(
    data: ITreeNode<U>[],
    key: ITreeNode<U>['key']
): ITreeNode<U> | null => {
    for (const node of data) {
        if (node.children?.some((child) => child.key === key)) {
            return node;
        }
        // \u5982\u679C\u6709\u5B50\u8282\u70B9\uFF0C\u9012\u5F52\u67E5\u627E
        if (node.children) {
            const parent = findParentNodeByKey(node.children, key);
            if (parent) return parent;
        }
    }
    return null;
};

/**
 * \u5728 key \u8282\u70B9\u4E2D\u6DFB\u52A0\u5B50\u8282\u70B9
 * @param data \u904D\u5386\u7684\u6570\u7EC4
 * @param key \u5F53\u524D key \u503C
 * @returns \u63D2\u5165\u65B0\u6570\u636E\u4E4B\u540E\u7684 data
 */
export const appendNodeByKey = <U extends { edit?: boolean }>(
    data: ITreeNode<U>[],
    key: ITreeNode<U>['key']
): ITreeNode<U>[] => {
    const newNode = { key: 'new_', title: '', edit: true };
    return data.map((node) => {
        if (node.key === key) {
            const updatedChildren = node.children ? [...node.children, newNode] : [newNode];
            return { ...node, children: updatedChildren };
        }
        if (node.children) {
            return { ...node, children: appendNodeByKey(node.children, key) };
        }
        return node;
    });
};

/**
 * \u79FB\u9664 key \u8282\u70B9
 * @param data \u904D\u5386\u7684\u6570\u7EC4
 * @param key \u5F53\u524D key \u503C
 * @returns \u5220\u9664\u6570\u636E\u4E4B\u540E\u7684 data
 */
export const removeNodeByKey = <U,>(
    data: ITreeNode<U>[],
    key: ITreeNode<U>['key']
): ITreeNode<U>[] => {
    return data
        .filter((node) => node.key !== key)
        .map((node) => {
            if (node.children) {
                return {
                    ...node,
                    children: removeNodeByKey(node.children, key),
                };
            }
            return node;
        });
};

/**
 * \u79FB\u9664 edit \u4E3A true \u7684\u8282\u70B9
 * @param treeData
 * @returns \u79FB\u9664\u4E4B\u540E\u7684\u6570\u636E
 */
export const removeEditNode = <U extends { edit?: boolean }>(
    treeData: ITreeNode<U>[]
): ITreeNode<U>[] => {
    return treeData
        .filter((node) => !node.edit)
        .map((node) => ({
            ...node,
            children: node.children ? removeEditNode(node.children) : undefined,
        }));
};

/**
 *
 */

export const insertChildIntoNode = <U extends { edit?: boolean }>(
    treeData: ITreeNode<U>[],
    key: ITreeNode<U>['key'],
    children: ITreeNode<U>[]
): ITreeNode<U>[] => {
    return treeData.map((node) => {
        if (node.key === key) {
            return {
                ...node,
                children,
            };
        }
        if (node.children) {
            return {
                ...node,
                children: insertChildIntoNode(node.children, key, children),
            };
        }
        return node;
    });
};
`}}]);
